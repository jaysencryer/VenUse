# VenUse

---
## A Venue management and Booking App 
### by Jaysen Cryer
#### CS50 web Capstone Project
---

### Contents

[Project Overview](#project-overview)

[How to Run](#how-to-run)

[Distinctiveness and Complexity](#distinctiveness-and-complexity)

[How to Run Tests](#how-to-run-tests)

[Project File Structure](#project-file-structure)

- [React Components](#react-components)
- [JavaScript Files](#javascript-files)
- [Template files](#template-files)
- [Python Unit Tests](#python-unit-tests)
---
## Project Overview

VenUse is a mobile-responsive web app that allows Venue owners to create and manage Venues with multiple 'Rooms' that can be booked in three different time slots.  Each Venue has a direct url that can be shared for users to navigate to and book those rooms.
In order to book a room a User has to create a login.  They are then able to book rooms in any Venue they have the url for, (or they can see the top five most popular Venues.)  A User can also create their own Venues.

Possible use cases:-

- Recreation Center :- A recreation center with multiple rooms for holding classes.
- Recording Studio :- If a recording studio had varying sizes of studio rooms with different capabilities.
- A co-working space :- Each 'Room' could represent a desk which you could book for a four hour slot.
- Rehearsal Space :- A performing arts center that had many rooms to rent out as rehearsal space.

What this current MVP does not do:-

- Currently you are limited to the three time slots Morning, Afternoon & Evening.  Ideally this could be expanded to allow more granular
scheduling, which could then open this up to be used for a hair or nail salon, or massage studio.
- Payment.  This app currently does not facilitate any payment for booking the room.

Wish list additions before production ready:-

- Add photos to the Venue homepage and rooms

---
## How to Run

Clone the repo.
cd into the root directory of capstone and type:-

``> pip install -r requirements.txt``
``> python manage.py runserver``

The web app will then be available at http://localhost:8000

A User would be expected to enter the App through a Venue's Homepage Venue/<venue.url>
A Venue owner would be expected to navigate to the / path of the app once logged in to Manage their venues. 

---
## Distinctiveness and Complexity

VenUse uses four Django Models to create the dynamic of Venue, Room & Bookings.  The added complexity of setting availabilities on the Rooms, and allowing a User to book that room at any point in the future, I feel, distinguishes it from any prior CS50 web project.
I took on the extra challenge of creating my own Calendar functionality in React, only using the built in datetime library from Python and the JavaScript Date built in object.
Additionally, before I decided to add React (as I began learning it for my job), I wrote my own JavaScript functions to simplify the DOM manipulation.

---
## How to Run Tests

### Python 
- ``> python manage.py test VenUse/tests/api VenUse/tests/availability``
- With coverage
    - ``> coverage run --source='.' manage.py test VenUse/tests/api VenUse/tests/availability``
    - ``> coverage html`` - this will create an html file to easily view the coverage report ``htmlcov/index.html``

### JavaScript
- Install Jest using ``> npm install``
- Run ``npx jest --coverage`` 
    - Note: ``Booking.test.js`` will fail unless you uncomment the ``import React from 'react';`` line in ``Booking.jsx``

[Back to Top](#VenUse)
---
## Project File Structure

### ``VenUse/``

Python files, **apps.py** and **admin.py** not listed as they are generated by django and only changed minimally.

- ``api.py``
     
     Contains api endpoints which return JsonResponses to database queries.  These are leveraged by the JavaScript frontend.
     - ``/get_venue/<venue_id>`` - retrieves **Venue** information including Rooms, Bookings and Address.
     - ``/add_room`` - adds a new room to a **Venue**
     - ``/add_venue`` - adds a **Venue** this works as both a json endpoint, and a http POST.
     - ``/get_availability/<room_id>`` - retrieves the **Availability** of a **Room**
     - ``/make_booking`` - makes a booking for requested slots in a room on a given date.
     - ``/get_bookings/<room_id>`` - retrieves all **Bookings** from today forward for a given **Room**
     - ``/get_bookings/<venue_id>`` - mapped to ``get_venue_bookings`` - retrieves all **Bookings** from today forward for a given **Venue** 
     - ``/get_bookings/<username>`` - mapped to ``get_user_bookings`` - retrieves all **Bookings** from today forward for a given **User**
     - ``/post_address/<venue_id>`` - adds an **Address** to a **Venue** if it doesn't already have one.

- ``availability.py``
     
     Contains Availability & AvailField classes written to support the availability of a Room.
     Availability in this version is either Morning, Afternoon or Evening.  
     To keep the logic of this neat and efficient I've assigned the three slots equivelant binary values,
     e.g 111 = morning, afternoon & evening = 7.  From that Morning = 4, Afternoon = 2 and Evening = 1.
     This allows me throughout the software to determine very easily which of the three slots is avaiable or booked by using &
     ``booked_slots & 4`` for example would yield result of 4 if the morning was booked, 0 if not. 

- ``models.py``
     
    Contains models for VenUse including
    - User (extended to include fullname field)
    - Venue
    - Room (each Venue has many rooms)
    - Booking (each Room & User can have multiple bookings)
    - Address (each Venue can have one address)

- ``react.py``

    Contains two lists of React component names to help with dynamic rendering into html file.  
    This could be replaced in future by using something like WebPack to bundle the React App/Pages separately.

- ``urls.py``

    Contains view and api url mappings.

- ``views.py``   

    Contains all View Methods for Django rendering - setting up templates for JavaScript & React Front Ends.

[Back to Top](#VenUse)

### ``VenUse/static/VenUse/assets``

This directory contains all variations of the favicon I created for this app.

### ``VenUse/static/VenUse/css``

- ``styles.css``

    Contains main css styling for the app - as used by django html templates and regular JavaScript files.

### React Components
### ``VenUse/static/VenUse/src/components``

This directory contains all React jsx components.  These handle the **Venue** homepage and **User Bookings** rendering. Each component has it's own directory.

- ``react.css``

    Contains all css for React components.  Separated for ease of maintenance.

- ``AvailabilityCalendar/AvailabilityCalendar.jsx``

    This component renders a ``Calendar`` (using the Calendar component) and passes an ``AvailDay`` component as a child to render on each day.  This design enabled me to write a generic ``Calendar`` component that I could re-use or develop as a standalone module.

- ``AvailDay/AvailDay.jsx``

    ``AvailDay`` extracts the logic of determining the day of a given date from the ``ShowAvail`` component.

- ``AvailIcon/AvailIcon.jsx``

    A component which renders a graphical indication of the **Availability** of any given **Room** on any given day.
    Currently it renders an empty circle if there is availability.  A solid one if there is not.
    If we place ``devOnly=true`` in the URL it will render a more complex color coded icon that indicates Morning, Afternoon or Evening availability, with different colors if the slot is booked or unavailable.
    Cleary I'm not a UX designer.

- ``Booking/Booking.jsx``

    Displays a users **Booking**.  The **Venue** is rendered as a link to it's homepage.  
    Duplicates a ``showBookedSlots()`` function which renders the slots in text e.g. "Morning, Afternoon, Evening."
    This function also appears in ``utils.js`` but because of the awkward way that **React** is being implemented I was unable to import that here.

- ``Booking/Booking.test.js``

    A Jest unit test to test the component.  The test gives 100% coverage of the component, however in order for it to run the component must include ``import React from 'react';``.  Due to the way **React** is implemented in this project this breaks
    the component on running.  There are other ways to get around this, but to progress this software further I would be looking
    to use webpack to bundle **React**.  This is the only React test I wrote (I do them every day for my job now, so no need for practice)

- ``BookSlots/BookSlots.jsx``

    A modal that allows users to select which slot they which to book in a **Room** on any given date.  The checkboxes are disabled if the slot is already booked, or if the slot is unavailable.  This component calls the ``/make_booking`` **POST** endpoint. 

- ``Calendar/Calendar.jsx``

    This component renders a mobile responsive (to be fair it looks better not on mobile currently) Calendar, where each ``Day`` is a component that renders any children passed to the Calendar.  It defaults to showing todays month and highlights todays date.  It allows users to change the month forward and backwards.

- ``Calendar/Calendar.css``

    Styling specifically for this component and the ``Day`` component.  Purposely kept separate so these modules could be re-used.

- ``Day/Day.jsx``

    The ``Day`` component renders a day square (row on mobile) with the date highlighted if it is the current (active) date.  It also renders any children passed from ``Calendar``

- ``Modal/Modal.jsx``

    Wrapper component to render content in a modal.  Accepts an ``onClose()`` function and any children to render within it.

- ``MonthSelect/MonthSelect.jsx``

    Component that shifts the rendering of the Month Selector out of the ``Calendar`` component.

- ``Room/Room.jsx``

    Displays information about a **Room** on a **Venue** homepage.  Includes button to book, and pulls up to date booking data on initial rendering.

- ``ShowAvail/ShowAvail.jsx``

    Shows the availability of a **Room** on a given date.  Handles checks for clickability, renders the ``AvailIcon`` and launches the ``BookSlots`` modal when clicked.

- ``ShowRooms/ShowRooms.jsx``

    Fetches **Room** data for a given **Venue** and displays a ``Room`` component for each one.

- ``UserBookings/UserBookings.jsx``

    Retrieves **Bookings** for a given **User** and renders a ``Booking`` component for each one.

- ``Venue/Venue.jsx``

    Main component that renders information for a **Venue** on its homepage.  Renders ``VenueTitle``, ``VenueAddress`` and ``ShowRooms`` for the **Venue**

- ``VenueAddress/VenueAddress.jsx``

    Renders a **Venues** **Address**

- ``VenueTitle/VenueTitle.jsx``

    Renders a **Venues** title.

[Back to Top](#VenUse)

### JavaScript Files
### ``VenUse/static/VenUse/src/javascript``

This directory contains all JavaScript files.  The JavaScript files handle the Manage Venues flow of the software. 

- ``address.js``

    Handles DOM manipulation fucntions to add, save, and render an **Address**.  It uses the ``/post_address`` endpoint.

- ``availability.js``

    Functions to create an **Availability** form from an availability object, and return availability score from that form.

- ``bookings.js``

    Renders bookings for a given **Venue** using ``/get_bookings/<venue_id>`` endpoint.

- ``utils.js``

    Includes helper functions to make DOM manipulation & fetch requests less painful.

- ``venues.js``

    Main JavaScript for the Manage **Venues** flow.  Single Page Application allows adding and updating of **Rooms** and **Venues**.

[Back to Top](#VenUse)

### ``VenUse/static/VenUse/src/javascript/tests``

This directory contains Jest tests for ``address.js`` and ``utils.js``

### Template Files
### ``VenUse/templates/VenUse``

This contains all ``html`` templates for the **VenUse** app.

- ``availability_form.html``

    Original availability form, replaced by JavaScript dynamically built one.  Still here, for some reason.

- ``default_venue.html``

    Basic template for rendering **Venue** homepage **React** pages.

- ``index.html``

    Main page template.

- ``layout.html``

    Handles Nav bar and renders Profile menu.

- ``login.html`` Login page
- ``manage_venues.html``

    Renders django forms for adding a **Venue** and a **Room**, container and basic ``html`` structure for ``venues.js``

- ``profile_menu.html``

    Renders the profile menu.

- ``react-bookings.html``

    **React** launchpad for User **Bookings** page.

- ``react-script.html``

    **React** launchpad for **Venue** homepage

- ``register.html`` Register User Page

- ``user_bookings.html`` 

    Basic template for rendering User **Bookings React** pages.

[Back to Top](#VenUse)

### Python Unit Tests
### ``VenUse/tests/api``

**Python** unit tests for all endpoints in api.py.  ``test_get_bookings.py`` tests all three get_bookings variations.
coverage at 91% for all **Python** files.  99% for ``api.py``

### ``VenUse/tests/availability``

**Python** unit tests for ``availability.py``.  Coverage at 85%

[Back to Top](#VenUse)
